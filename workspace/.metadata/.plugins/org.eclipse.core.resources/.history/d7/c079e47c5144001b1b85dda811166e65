package service;

import java.util.HashMap;
import java.util.Map;

import util.ScanUtil;
import util.View;
import controller.Controller;
import dao.UserDao;

public class UserService {
	
	private static UserService instance;
	private UserService(){}
	public static UserService getInstance(){
		if(instance == null){
			instance = new UserService();
		}
		return instance;
	}
	
	private UserDao userDao = UserDao.getInstance();
	
	public int signIn(){	
		System.out.println("â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– â–¡â– \n");
		System.out.println("                                 ğŸ½ï¸ ì˜¤ëŠ˜ ë­ë¨¹ì§€? ğŸ½ï¸\n");
		System.out.print("ì•„ì´ë””");
		String userId = ScanUtil.nextLine();
		System.out.print("ë¹„ë°€ë²ˆí˜¸>");
		String password = ScanUtil.nextLine();
		
		Map<String, Object> user = userDao.userSignIn(userId,password);
		
		if(user.size() ==0){	//user == null
			System.out.println("ì•„ì´ë”” í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì˜ëª» ì…ë ¥í–ˆìŠµë‹ˆë‹¤.");
		}else{
			System.out.println("ë¡œê·¸ì¸ ì„±ê³µ");
			Controller.user = user;
			
			if(user.get("USER_ID").equals("admin"))	//	ë¡œê·¸ì¸í•œ ê³„ì •ì´ adminì¼ ê²½ìš° ê´€ë¦¬í™”ë©´ìœ¼ë¡œ ê°‘ë‹ˆë‹¤
					return View.ADMIN_MAIN;
			
			return View.USER_MAIN;
		}
		
		
		
		return View.SIGNIN;
	}
	
	public int signUp(){	// ì‘ì„± í•„ìš”
		System.out.println("=============== íšŒì›ê°€ì… ==============");
		System.out.print("ì•„ì´ë”” >");
		String userId = ScanUtil.nextLine();
		System.out.print("ë¹„ë°€ë²ˆí˜¸ >");
		String password = ScanUtil.nextLine();
		System.out.print("ë‹‰ë„¤ì„ >");
		String nickname = ScanUtil.nextLine();
		
		Map<String, Object> param = new HashMap<String, Object>();
		param.put("USER_ID", userId);
		param.put("PASSWORD", password);
		param.put("NICKNAME", nickname);
		
		int result = userDao.userSignUp(param);
		
		if(0 < result){
			System.out.println("íšŒì›ê°€ì… ì„±ê³µ");
			return View.USER_MAIN;	// ê°€ì…ì— ì„±ê³µí•˜ë©´ USER_MAIN í™”ë©´ìœ¼ë¡œ ê°‘ë‹ˆë‹¤.
		}else{
			System.out.println("íšŒì›ê°€ì… ì‹¤íŒ¨");
			return View.MAIN;		// ê°€ì…ì— ì‹¤íŒ¨í•˜ë©´ MAIN í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.
		}
	}
	
	public int userMain(){
		System.out.println("USER MAIN");
		ScanUtil.nextLine();
		
		return View.MAIN;
		
	}
	
	public int guestMode(){	
		
		Map<String, Object> user = userDao.userSignIn("guest","guest");
		
		if(user.size() ==0){	//user == null
			System.out.println("ì•„ì´ë”” í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì˜ëª» ì…ë ¥í–ˆìŠµë‹ˆë‹¤.");
		}else{
			Controller.user = user;
			System.out.println("ë¹„íšŒì›ìœ¼ë¡œ ì´ìš©í•©ë‹ˆë‹¤.");
			
			return View.USER_MAIN;
		}
		
		
		return View.SIGNIN;
	}

}
